<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bzz.cloud.rbac.dao.SysUserDao">

	<sql id="userColumns">
		t.id AS id,
		t.login_name AS loginName,
		t.password AS password,
		t.work_num AS workNum,
		t.name AS name,
		t.email AS email,
		t.phone AS phone,
		t.mobile AS mobile,
		t.user_type AS userType,
		t.photo AS photo,
		t.old_login_name AS oldLoginName,
		t.new_password AS newPassword,
		t.account_non_expired AS accountNonExpired,
		t.account_non_locked AS accountNonLocked,
		t.credentials_non_expired AS credentialsNonExpired,
		t.enabled AS enabled,
		t.create_user_id AS createUserId,
		t.create_time AS createTime,
		t.update_user_id AS updateUserId,
		t.update_time AS updateTime,
		t.todo AS todo,
		t.remarks AS remarks,
		t.del_flag AS delFlag,
		t.version AS version

	</sql>

	<sql id="userOracleColumns">
		tt.id AS id,
		tt.login_name AS loginName,
		tt.password AS password,
		tt.work_num AS workNum,
		tt.name AS name,
		tt.email AS email,
		tt.phone AS phone,
		tt.mobile AS mobile,
		tt.user_type AS userType,
		tt.photo AS photo,
		tt.old_login_name AS oldLoginName,
		tt.new_password AS newPassword,
		tt.account_non_expired AS accountNonExpired,
		tt.account_non_locked AS accountNonLocked,
		tt.credentials_non_expired AS credentialsNonExpired,
		tt.enabled AS enabled,
		tt.create_user_id AS createUserId,
		tt.create_time AS createTime,
		tt.update_user_id AS updateUserId,
		tt.update_time AS updateTime,
		tt.todo AS todo,
		tt.remarks AS remarks,
		tt.del_flag AS delFlag,
		tt.version AS version

	</sql>
	<!--根据用户名获得用户 -->
	<select id="getUserByLoginName" resultType="com.bzz.cloud.rbac.entity.SysUser">
		SELECT
		<include refid="userColumns"/>
		FROM sys_user t WHERE t.login_name = #{loginName}
	</select>

	<!--根据编号获得用户 -->
	<select id="get" resultType="com.bzz.cloud.rbac.entity.SysUser">
		SELECT
		<include refid="userColumns"/>
		FROM sys_user t WHERE t.id = #{id}
	</select>



	<select id="selectUser">
		SELECT
		<include refid="userColumns"/>
		FROM sys_user t
		WHERE t.del_flag = 0  and t.id = 1
	</select>

	<!-- 分页查询用户信息 -->
	<select id="selectList" resultType="com.bzz.cloud.rbac.entity.SysUser">
		<if test="dbType == null and dbType == ''  ">
			<include refid="pageMysql" />
		</if>
		<if test="dbType != null and dbType != '' and dbType == 'mysql'">
			<include refid="pageMysql" />
		</if>
		<if test="dbType != null and dbType != '' and dbType == 'oracle'">
			<include refid="pageOracle"/>
		</if>
	</select>

	<select id="findCount" resultType="java.lang.Integer">
		SELECT
			count(*)
		FROM sys_user t
		<where>
			t.del_flag = 0
			<if test="loginName != null and loginName != ''">
				AND t.login_name LIKE
				<if test="dbType == 'oracle'">'%'||#{loginName}||'%'</if>
				<if test="dbType == 'mysql'">CONCAT('%', #{loginName}, '%')</if>
			</if>
		</where>

	</select>


	<insert id="insert"  useGeneratedKeys="true" keyProperty="id" >
		INSERT INTO sys_user(
				id,
				login_name,
				password,
				work_num,
				name,
				email,
				phone,
				mobile,
				user_type,
				photo,
				old_login_name,
				new_password,
				account_non_expired,
				account_non_locked,
				credentials_non_expired,
				enabled,
				create_user,
				create_time,
				update_user,
				update_time,
				todo,
				del_flag
				) VALUES (
								 #{id},
								 #{loginName},
								 #{password},
								 #{workNum},
								 #{name},
								 #{email},
								 #{phone},
								 #{mobile},
								 #{userType},
								 #{photo},
								 #{oldLoginName},
								 #{newPassword},
								 #{accountNonExpired},
								 #{accountNonLocked},
								 #{credentialsNonExpired},
								 #{enabled},
								 #{createUser.id},
								 #{createTime},
								 #{createUser.id},
								 #{updateTime},
								 #{todo},
								 #{delFlag}
								 )
	</insert>

		<sql id="pageMysql">
			SELECT
			<include refid="userColumns"/>
			FROM sys_user t
			<where>
				t.del_flag = 0
				<if test="loginName != null and loginName != ''">
					AND t.login_name LIKE CONCAT('%', #{loginName}, '%')
				</if>


			</where>
			<choose>
				<when test="page !=null and page.orderBy != null and page.orderBy != ''">
					ORDER BY ${page.orderBy}
				</when>
				<otherwise>
					ORDER BY t.update_time DESC LIMIT #{page.pageNum},#{page.pageSize}
				</otherwise>

			</choose>
		</sql>

		<sql id="pageOracle">
			SELECT *
			from (
					SELECT <include refid="userColumns"/>,rownum rownu FROM sys_user t
					<where>
						t.del_flag = 0
						<if test="loginName != null and loginName != ''">
							AND t.login_name LIKE
							<if test="dbType == 'oracle'">'%'||#{loginName}||'%'</if>
						</if>
					</where> AND
					rownum &lt;= #{page.pageNum} * #{page.pageSize}
				) tt
			where tt.rownu > (#{page.pageNum}-1) * #{page.pageSize}
		</sql>
</mapper>